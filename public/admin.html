<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üî• Roni Admin Panel</title>
<style>
  body {
    background: #000;
    color: #00ff88;
    font-family: "Poppins", sans-serif;
    text-align: center;
    padding: 20px;
  }
  h1 {
    color: #00ffaa;
    font-size: 28px;
  }
  input, button, select {
    padding: 10px;
    margin: 6px;
    border-radius: 10px;
    border: none;
    font-size: 15px;
  }
  input {
    background: #111;
    color: #0f0;
    border: 1px solid #00ff80;
    text-align: center;
    width: 250px;
  }
  button {
    background: #00ff80;
    color: #000;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: #0f0;
    transform: scale(1.05);
  }
  #keys {
    margin-top: 20px;
  }
  .key-box {
    background: #111;
    border: 1px solid #00ff80;
    padding: 10px;
    margin: 10px auto;
    width: 340px;
    border-radius: 10px;
  }
  .key-box p { margin: 5px; }
  .actions button {
    margin: 4px;
    border-radius: 8px;
    padding: 6px 10px;
  }
  .delete { background: red; color: #fff; }
  .toggle { background: orange; color: #000; }
</style>
</head>
<body>
  <h1>üî• Roni API Admin Panel</h1>

  <div id="login">
    <h3>Enter Admin Password üîê</h3>
    <input type="password" id="pass" placeholder="Enter password" />
    <br />
    <button onclick="login()">Login</button>
    <p id="msg"></p>
  </div>

  <div id="panel" style="display:none;">
    <h3>Generate New Key</h3>
    <select id="days">
      <option value="1">1 Day</option>
      <option value="5">5 Days</option>
      <option value="7">7 Days</option>
    </select>
    <button onclick="generateKey()">Generate</button>
    <h3>All Keys</h3>
    <div id="keys"></div>
  </div>

<script>
async function login() {
  const password = document.getElementById("pass").value;
  const res = await fetch("/admin/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ password })
  });
  const data = await res.json();
  if (data.success) {
    document.getElementById("login").style.display = "none";
    document.getElementById("panel").style.display = "block";
    loadKeys();
  } else {
    document.getElementById("msg").innerText = "‚ùå Wrong password!";
  }
}

async function generateKey() {
  const days = parseInt(document.getElementById("days").value);
  await fetch("/admin/generate", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ days })
  });
  loadKeys();
}

async function loadKeys() {
  const res = await fetch("/admin/keys");
  const data = await res.json();
  const container = document.getElementById("keys");
  container.innerHTML = "";
  data.keys.forEach(k => {
    const expiry = new Date(k.expiry).toLocaleString();
    const div = document.createElement("div");
    div.className = "key-box";
    div.innerHTML = `
      <p><b>${k.key}</b></p>
      <p>Status: ${k.status === "active" ? "üü¢ Active" : "üî¥ Inactive"}</p>
      <p>Expires: ${expiry}</p>
      <div class="actions">
        <button class="toggle" onclick="toggleKey('${k.key}')">Toggle</button>
        <button class="delete" onclick="deleteKey('${k.key}')">Delete</button>
      </div>
    `;
    container.appendChild(div);
  });
}

async function toggleKey(key) {
  await fetch("/admin/toggle", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ key })
  });
  loadKeys();
}

async function deleteKey(key) {
  if (!confirm("Delete " + key + "?")) return;
  await fetch("/admin/delete", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ key })
  });
  loadKeys();
}
</script>
</body>
</html>
