<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RONI MOD MENU</title>
  <style>
    body{background:#000;color:#0f0;font-family:Inter,system-ui,Arial;margin:0;padding:20px}
    .wrap{max-width:980px;margin:0 auto}
    h1{text-align:center;color:#00ff99}
    .card{background:#071018;border:1px solid rgba(0,255,136,0.06);padding:14px;border-radius:8px;margin-bottom:12px}
    input,select,button{padding:8px;border-radius:8px;border:1px solid rgba(0,255,136,0.1);background:#071217;color:#cfffda}
    button{background:linear-gradient(90deg,#00ff99,#00cc77);color:#001;font-weight:700;cursor:pointer}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid rgba(0,255,136,0.03);text-align:left}
    .muted{color:#8fd8b1;font-size:13px}
    .control-row{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:#9ddfb6}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>RONI MOD MENU</h1>

    <div id="loginBox" class="card">
      <div class="control-row">
        <input id="pwd" type="password" placeholder="Admin password">
        <button onclick="login()">Login</button>
        <span id="loginMsg" class="small"></span>
      </div>
    </div>

    <div id="panel" style="display:none;">
      <div class="card">
        <div class="control-row">
          <input id="note" placeholder="Note (optional)">
          <input id="qty" type="number" min="1" max="200" value="1" style="width:90px" />
          <select id="preset">
            <option value="0">Unlimited</option>
            <option value="1">1 day</option>
            <option value="5">5 day</option>
            <option value="7">7 day</option>
            <option value="30">30 day</option>
            <option value="60">60 day</option>
          </select>
          <button onclick="createKeys()">Generate</button>
          <button onclick="refresh()">Refresh</button>
        </div>
        <div class="small muted" style="margin-top:8px">Tip: choose preset or set 0 for unlimited.</div>
      </div>

      <div class="card">
        <table>
          <thead><tr><th>Key</th><th>Created</th><th>Expires</th><th>Last Login</th><th>Active</th><th>Note</th><th>Actions</th></tr></thead>
          <tbody id="keysBody"></tbody>
        </table>
      </div>
    </div>

  </div>

<script>
async function login(){
  const pwd = document.getElementById('pwd').value;
  if(!pwd) return alert('Enter password');
  const res = await fetch('/admin/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({password:pwd})});
  const j = await res.json();
  if(j.success){
    document.getElementById('loginBox').style.display='none';
    document.getElementById('panel').style.display='block';
    refresh();
  } else {
    document.getElementById('loginMsg').innerText = 'Wrong password';
  }
}

async function refresh(){
  const res = await fetch('/admin/keys');
  const j = await res.json();
  const body = document.getElementById('keysBody');
  body.innerHTML = '';
  j.keys.forEach(k=>{
    const created = new Date(k.createdAt).toLocaleString();
    const expires = k.expiresAt ? new Date(k.expiresAt).toLocaleString() : 'Never';
    const last = k.lastLogin ? new Date(k.lastLogin).toLocaleString() : '-';
    const active = k.active ? 'ON' : 'OFF';
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><code>${k.key}</code></td>
                    <td>${created}</td>
                    <td>${expires}</td>
                    <td>${last}</td>
                    <td>${active}</td>
                    <td>${k.note || ''}</td>
                    <td>
                      <button onclick='toggle("${k.key}")'>Toggle</button>
                      <button onclick='setExpiryPrompt("${k.key}")'>SetExp</button>
                      <button onclick='del("${k.key}")' style="background:#ff6666">Delete</button>
                    </td>`;
    body.appendChild(tr);
  });
}

async function createKeys(){
  const qty = Number(document.getElementById('qty').value) || 1;
  const days = Number(document.getElementById('preset').value) || 0;
  const note = document.getElementById('note').value || '';
  const res = await fetch('/admin/create',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({qty, days, note})});
  const j = await res.json();
  if(j.success) {
    alert('Created: ' + (j.created?.length || 0));
    refresh();
  } else alert('Create failed');
}

async function toggle(key){
  await fetch('/admin/toggle', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({key})});
  refresh();
}

async function del(key){
  if(!confirm('Delete '+key+' ?')) return;
  await fetch('/admin/delete',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({key})});
  refresh();
}

function setExpiryPrompt(key){
  const days = prompt('Set expiry in days (0 = unlimited):', '0');
  if(days === null) return;
  fetch('/admin/set-expiry', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({key, days: Number(days)})})
    .then(()=>refresh());
}
</script>
</body>
</html>
